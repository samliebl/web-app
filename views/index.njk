{% extends "_layouts/base.njk" %}
{% block content %}
<div></div>
<!-- Section noting the GET response -->
<section id="test-get">
    <h2>Demonstration of a <code>GET</code> API call/request</h2>
    <p>The fact this page is rendering is a demonstration of a <code>GET</code> API call.</p>
    <p>Behind the scenes, the server contains the following routing for the API calls:</p>
    <pre><code class="language-js">// Routes
app.get('/', (req, res) => {
    res.render('index.njk', wrapper); // Pass the wrapper as context
});

app.post('/submit', (req, res) => {
    const { name } = req.body;
    res.json({ message: `Hello, ${name}! This is a POST response.` });
});</code></pre>
    <p>When the user navigates to the base directory (<code>/</code>), the backend is serving a Nunjucks template to render to HTML in the browser via a GET API call.</p>
</section>
<div></div>
<hr>
<div></div>
<!-- Section to test POST request -->
<section id="test-post">
    <h2>Demonstration of a <code>POST</code> API call/request</h2>
    <form id="nameForm" action="/submit" method="POST">
        <input type="text" name="name" id="nameInput" placeholder="Enter your name">
        <button type="submit">Submit</button>
    </form>
    <!-- Placeholder for displaying styled POST response -->
    <div id="responseMessage"></div>
    <!-- Placeholder for displaying raw JSON POST response -->
    <pre id="jsonResponse"></pre>
</section>
<div></div>
<hr>
<div></div>
<section id="client-side-javascript">
    <h2>Note on Client-Side JavaScript</h2>
    <p>Then, there’s the JavaScript working on the front end to tie it all together and improve user experience.</p>
    <p>You can find it by inspecting this page with your browser’s developer, tools, or by reviewing the code on the <a href="https://github.com/samliebl/web-app">GitHub repo</a>.</p>
</section>
<!-- Client-side JavaScript for handling AJAX requests -->
<script type="text/javascript">
// Handle POST request for form submission
document.getElementById('nameForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission

    // Get the input value
    const nameInput = document.getElementById('nameInput').value;

    // Send AJAX request to server
    fetch('/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name: nameInput })
        })
        .then(response => response.json())
        .then(data => {
            // Display the POST response message in styled HTML
            document.getElementById('responseMessage').innerHTML = `
            <p>${data.message}</p>
        `;

            // Display the raw JSON POST response
            document.getElementById('jsonResponse').textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => console.error('Error:', error));
});
</script>
{% endblock %}